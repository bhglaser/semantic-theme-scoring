# ============================================================
# Intangible Investment from 10-K Filings â€” Example Config
# ============================================================
# This config replicates the paper's exercise on the sample data.
# Adjust paths as needed for your environment.

run_name: "intangible_investment"
output_root: "./output"
random_seed: 42
max_workers: 8

# === STAGE 1: TEXT EXTRACTION ===
extract:
  input_dir: "./examples/intangible_investment/sample_10k_texts"
  input_format: "text"

  # Sample files are already cleaned Item 7 text, so no extraction needed
  html_cleaning:
    enabled: false
    strip_tags: ["div", "tr", "td", "font", "p", "table"]

  section_extraction:
    enabled: false
    start_patterns:
      - "item\\s*7\\.?\\s*:?\\s*management.?s?\\s+discussion\\s+and\\s+analysis"
    end_patterns:
      - "item\\s*8\\.?\\s*:?\\s*(consolidated\\s+)?financial\\s+statements"
    min_words: 250

# === STAGE 1b: LLM TEXT EXTRACTION ===
# The paper uses an LLM to extract SG&A-focused quotes from each document's
# Item 7 before building the n-gram dictionary. This filters the corpus to
# expense-relevant text only.
llm_extract:
  enabled: true
  provider: "ollama"                 # "ollama" (local, free) or "openai" (requires OPENAI_API_KEY)
  ollama_model: "gemma3n:e2b"
  openai_model: "gpt-4o-mini"
  max_workers: 1
  context_lines_before: 0
  context_lines_after: 10
  expense_keywords:
    sga:
      - "selling, general and administrative"
      - "sg&a"
      - "selling, general and administrative expense"
      - "selling, general and administrative expenses"
    general_and_administrative:
      - "general and administrative"
      - "general and administrative expense"
      - "general, administrative and other expense"
      - "general expense"
      - "administrative expense"
      - "general and administrative expenses"
      - "general, administrative and other expenses"
      - "general expenses"
      - "administrative expenses"
    sales_and_marketing:
      - "sales and marketing"
      - "sales and marketing expense"
      - "selling and marketing expense"
      - "sales expense"
      - "marketing expense"
      - "advertising expense"
      - "sales and marketing expenses"
      - "selling and marketing expenses"
      - "sales expenses"
      - "marketing expenses"
      - "advertising expenses"
    operating_expense:
      - "operating expense"
      - "operating expenses"
      - "operational expense"
      - "operational expenses"

# === STAGE 2: N-GRAM CLUSTERING ===
ngrams:
  top_n: 10000
  ngram_range: [2, 3]
  pos_patterns:
    2: [["NN", "NN"]]
    3: [["NN", "NN", "NN"]]
  min_word_length: 3
  require_english_words: true
  custom_stop_words:
    # Company & legal
    - inc
    - corp
    - llc
    - ltd
    - company
    - companys
    - business
    # Document structure
    - note
    - item
    - form
    - page
    - sec
    - gaap
    - non-gaap
    - ebitda
    - sga
    - information
    - report
    - filing
    - discussion
    - disclosure
    - detail
    - http
    - https
    - www
    - etc
    - cetera
    - also
    - see
    # Time periods
    - fiscal
    - year
    - years
    - quarter
    - quarters
    - month
    - months
    - day
    - date
    - period
    - end
    - annum
    - january
    - february
    - march
    - april
    - may
    - june
    - july
    - august
    - september
    - october
    - november
    - december
    # Financial noise
    - increase
    - decrease
    - change
    - lower
    - higher
    - decline
    - result
    - due
    - consist
    - looking
    - look
    # Executive titles
    - officer
    - director
    - manager
    - executive
    - president
    - attorney
    - counsel
    - chief
    - vice
    - board
    - committee
    - chairman
    - ceo
    - cfo
    - coo
    - cto
    - shareholder
    - stockholder
    - behalf
    - holder
    # POS tagger noise
    - versus
    - include
    - including
    - exclude
    - excluding
    - following
    - pursuant
    - regarding
    - without
    - within
    - per
    - upon
    - among
    # Manual
    - revenue
    - profit
    - income

embedding:
  provider: "sentence-transformers"       # Use "openai" for higher quality if you have an API key
  openai_model: "text-embedding-3-large"
  openai_batch_size: 512
  st_model: "sentence-transformers/all-mpnet-base-v2"
  st_batch_size: 256
  force_cpu: false

clustering:
  # NOTE: These parameters are scaled down for the small sample corpus (10 documents, ~240 n-grams).
  # For the full paper corpus (thousands of documents, ~10,000 n-grams), we use:
  #   pca_components: 100, k_values: [500]
  pca_components: 50    # Reduced for small sample (must be < number of n-grams)
  pca_whiten: true
  k_values: [100]        # Reduced for small sample (must be < number of n-grams)
  kmeans_n_init: 10
  kmeans_max_iter: 300
  centroid_knn: 80
  edge_min_cosine: 0.65
  leiden_target_communities: [20, 50]
  leiden_resolution_grid: [0.1]
  min_cluster_size: 10
  min_similarity_score: 0.3

# === STAGE 3 ===
doc_ngrams:
  community_labels_csv: ""  # Fill in after running Stage 2 and labeling communities
  k_value: 100  # Must match k_values in clustering section
  # keyword_window is disabled: the paper uses full Item 7 text for per-document
  # n-gram extraction (not just SGA keyword neighborhoods).
  keyword_window:
    enabled: false
    patterns:
      - "\\bs\\.?\\s*g\\.?\\s*(?:&|and)\\s*a\\b"
      - "\\bsg\\s*&\\s*a\\b"
      - "\\bsga\\b"
      - "\\bselling[\\s,/\\-]*general[\\s,/\\-]*(?:&|and)[\\s,/\\-]*admin(?:istrative)?\\b"
      - "\\bselling[\\s,/\\-]*(?:&|and)[\\s,/\\-]*admin(?:istrative)?\\b"
      - "\\bgeneral[\\s,/\\-]*(?:&|and)[\\s,/\\-]*admin(?:istrative)?\\b"
    sentences_before: 1
    sentences_after: 10

# === STAGE 4 ===
scoring:
  embedding:
    provider: "sentence-transformers"
    st_model: "sentence-transformers/all-mpnet-base-v2"
    st_batch_size: 256
    force_cpu: false
  normalize_vectors: true
  similarity_threshold: 0.0
  relative_weight: false
  excluded_categories: []
  write_debug: false
